%
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{inborapport_2015}

\RequirePackage{kvoptions}
\RequirePackage{kvsetkeys}
\SetupKeyvalOptions{
  family=inborapport_2015,
  prefix=inborapport_2015@,
  setkeys=\kvsetkeys,
}

% hyperref options:
\define@key{inborapport_2015}{hyperref}{%
  \PassOptionsToPackage{#1}{hyperref}%
}
% babel options
\define@key{inborapport_2015}{babel}{%
  \PassOptionsToPackage{#1}{babel}%
}

\ProcessKeyvalOptions*

% definition of custom commands
\def\subtitle#1{\def\@subtitle{#1}}
\subtitle{}

\def\reportnumber#1{\def\@reportnumber{#1}}
\RequirePackage[yyyymmdd,hhmmss]{datetime}
\reportnumber{\today\space\currenttime}

\def\ordernumber#1{\def\@ordernumber{#1}}
\ordernumber{}

% define page geometry
\RequirePackage[a4paper, top = 2cm, bottom = 2.5cm, left = 3cm, right = 3cm]{geometry}

% add hyperlinks to the document
\RequirePackage[unicode=true]{hyperref}

% add title and author to the pdf file properties
\AtBeginDocument{
  \hypersetup{
    pdftitle = {\@title},
    pdfauthor = {\@author}
  }
}

% needed for markdown tables
\RequirePackage{longtable}

% needed for figures
\RequirePackage{graphicx}

% definition of INBO colours
\RequirePackage{xcolor}
\definecolor{inbo.blue}{RGB}{53, 97, 150}
\definecolor{inbo.red}{RGB}{190, 50, 84}
\definecolor{inbo.green}{RGB}{149, 155, 56}


% definition of block, alertblock and exampleblock
\RequirePackage{mdframed}

\newenvironment{block}[2][]{%
  \begin{mdframed}[backgroundcolor=inbo.blue!50]
  \textbf{#2}%

  \noindent%
}
{
  \end{mdframed}
}

\newenvironment{alertblock}[2][]{%
  \begin{mdframed}[backgroundcolor=inbo.red!50]
  \textbf{#2}%

  \noindent%
}
{
  \end{mdframed}
}

\newenvironment{exampleblock}[2][]{%
  \begin{mdframed}[backgroundcolor=inbo.green!50]
  \textbf{#2}%

  \noindent%
}
{
  \end{mdframed}
}

% definition of fonts
\RequirePackage{ifxetex}

\ifxetex
  \RequirePackage[no-math]{fontspec}
  \setmainfont[Ligatures=TeX]{Calibri}
  \setmonofont{Courier New}
\else
  \RequirePackage[T1]{fontenc}
  \RequirePackage[utf8]{inputenc}
  \RequirePackage{lmodern}
\fi

% required for the Euro symbol
\RequirePackage[gen]{eurosym}

% use babel for different languages
\RequirePackage{babel}

% define style for chapters
\def\@makechapterhead#1{%
   {\fontsize{14}{16.8} \selectfont \bfseries \thechapter \hfill \parbox[t]{142.4mm}{\raggedright #1}\par \nobreak}
  \vspace{16pt}
  }
\def\@makeschapterhead#1{%
   {\fontsize{14}{16.8} \selectfont \bfseries \raggedright #1\par \nobreak}
  \vspace{16pt}
  }

% define style for sections
\renewcommand{\section}{\secdef\@section\@ssection}
\def\@section[#1]#2{
  \ifnum \c@secnumdepth >\m@ne
    \refstepcounter{section}%
    \addcontentsline{toc}{section}%
      {\protect\numberline{\thesection}#1}%
  \else
    \addcontentsline{toc}{section}#1%
  \fi
  \@makesectionhead{#2}%
}
\def\@ssection#1{
  \@makessectionhead{#1}
}
\def\@makesectionhead#1{%
  \vspace{9pt}
   {\fontsize{12}{14.4} \selectfont \bfseries \noindent \thesection \hfill \parbox[t]{139.8mm}{\raggedright #1}\par \nobreak}
  \vspace{6pt}
}
\def\@makessectionhead#1{%
  \vspace{9pt}
   {\fontsize{12}{14.4} \selectfont \bfseries \noindent \hfill \parbox[t]{139.8mm}{\raggedright #1} \par \nobreak}
  \vspace{6pt}
}

% define style for subsections
\renewcommand{\subsection}{\secdef\@subsection\@ssubsection}
\def\@subsection[#1]#2{
  \ifnum \c@secnumdepth >\m@ne
    \refstepcounter{subsection}%
    \addcontentsline{toc}{subsection}%
      {\protect\numberline{\thesubsection}#1}%
  \else
    \addcontentsline{toc}{subsection}#1%
  \fi
  \@makesubsectionhead{#2}%
}
\def\@ssubsection#1{
  \@makessubsectionhead{#1}
}
\def\@makesubsectionhead#1{%
  \vspace{6pt}
   {\fontsize{10}{12} \selectfont \noindent \thesubsection \hfill \parbox[t]{137.3mm}{\raggedright #1}\par \nobreak}
  \vspace{6pt}
}
\def\@makessubsectionhead#1{%
  \vspace{6pt}
   {\fontsize{10}{12} \selectfont \noindent \hfill \parbox[t]{137.3mm}{\raggedright #1} \par \nobreak}
  \vspace{6pt}
}

% define style for subsubsections
\renewcommand{\subsubsection}{\secdef\@subsubsection\@ssubsubsection}
\def\@subsubsection[#1]#2{
  \ifnum \c@secnumdepth >\m@ne
    \refstepcounter{subsubsection}%
    \addcontentsline{toc}{subsubsection}%
      {\protect\numberline{\thesubsubsection}#1}%
  \else
    \addcontentsline{toc}{subsubsection}#1%
  \fi
  \@makesubsubsectionhead{#2}%
}
\def\@ssubsubsection#1{
  \@makessubsubsectionhead{#1}
}
\def\@makesubsubsectionhead#1{%
  \vspace{6pt}
   {\fontsize{10}{12} \selectfont \itshape \noindent \thesubsubsection \hfill \parbox[t]{134.8mm}{\raggedright #1}\par \nobreak}
  \vspace{6pt}
}
\def\@makessubsubsectionhead#1{%
  \vspace{6pt}
   {\fontsize{10}{12} \selectfont \itshape \noindent \hfill \parbox[t]{134.8mm}{\raggedright #1} \par \nobreak}
  \vspace{6pt}
}

% define style for paragraphs
\renewcommand{\paragraph}{\secdef\@paragraph\@sparagraph}
\def\@paragraph[#1]#2{
  \ifnum \c@secnumdepth >\m@ne
    \refstepcounter{paragraph}%
    \addcontentsline{toc}{paragraph}%
      {\protect\numberline{\theparagraph}#1}%
  \else
    \addcontentsline{toc}{paragraph}#1%
  \fi
  \@makeparagraphhead{#2}%
}
\def\@sparagraph#1{
  \@makesparagraphhead{#1}
}
\def\@makeparagraphhead#1{%
  \vspace{6pt}
   {\fontsize{9}{10.8} \selectfont \noindent \theparagraph \hfill \parbox[t]{132.2mm}{\raggedright #1}\par \nobreak}
  \vspace{6pt}
}
\def\@makesparagraphhead#1{%
  \vspace{6pt}
   {\fontsize{9}{10.8} \selectfont \noindent \hfill \parbox[t]{132.2mm}{\raggedright #1} \par \nobreak}
  \vspace{6pt}
}

% define style for subparagraphs
\renewcommand{\subparagraph}{\secdef\@subparagraph\@ssubparagraph}
\def\@subparagraph[#1]#2{
  \ifnum \c@secnumdepth >\m@ne
    \refstepcounter{subparagraph}%
    \addcontentsline{toc}{subparagraph}%
      {\protect\numberline{\thesubparagraph}#1}%
  \else
    \addcontentsline{toc}{subparagraph}#1%
  \fi
  \@makesubparagraphhead{#2}%
}
\def\@ssubparagraph#1{
  \@makessubparagraphhead{#1}
}
\def\@makesubparagraphhead#1{%
  \vspace{6pt}
   {\fontsize{9}{10.8} \selectfont \noindent \thesubparagraph \hfill \parbox[t]{129.7mm}{\raggedright #1}\par \nobreak}
  \vspace{6pt}
}
\def\@makessubparagraphhead#1{%
  \vspace{6pt}
   {\fontsize{9}{10.8} \selectfont \noindent \hfill \parbox[t]{129.7mm}{\raggedright #1} \par \nobreak}
  \vspace{6pt}
}

% changing style in table of contents
\renewcommand*\l@chapter{\vspace{6pt}\bfseries\@dottedtocline{1}{0mm}{20mm}}
\renewcommand*\l@section{\normalfont\@dottedtocline{2}{0mm}{20mm}}
\renewcommand*\l@subsection{\normalfont\@dottedtocline{3}{0mm}{20mm}}
\renewcommand*\l@subsubsection{\normalfont\@dottedtocline{4}{0mm}{20mm}}
\renewcommand*\l@paragraph{\normalfont\@dottedtocline{5}{0mm}{20mm}}
\renewcommand*\l@subparagraph{\normalfont\@dottedtocline{6}{0mm}{20mm}}

% set indent length
\setlength{\parindent}{0mm}

% define headers and footers
\RequirePackage{fancyhdr}
\pagestyle{fancy}
\fancyhead{}
\fancyfoot{}
\fancyfoot[LO,RE]{{\fontsize{7}{8.4}\selectfont www.inbo.be}}
\fancyfoot[CE, CO]{{\fontsize{7}{8.4}\selectfont \@reportnumber}}
\fancyfoot[LE,RO]{{\fontsize{7}{8.4}\selectfont \thepage}}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0.4pt}

\fancypagestyle{plain}{%
  \fancyhead{}
  \fancyfoot{}
  \fancyfoot[LO,RE]{{\fontsize{7}{8.4}\selectfont www.inbo.be}}
  \fancyfoot[CE, CO]{{\fontsize{7}{8.4}\selectfont \@reportnumber}}
  \fancyfoot[LE,RO]{{\fontsize{7}{8.4}\selectfont \thepage}}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0.4pt}
}

\fancypagestyle{cover}{%
  \fancyhead{}
  \fancyfoot{}
  \fancyfoot[L]{{\hspace{4mm}\includegraphics[height = 10mm, keepaspectratio]{logo_nl_kleur}}}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0.4pt}
}


% define title page
\def\maketitle{%
  \thispagestyle{cover}{%
    \hfill \includegraphics[height = 30mm, keepaspectratio]{vlaanderen_nl_vol}

    \vfill

    \raggedright \fontsize{20}{24}\selectfont \textbf{\@title}
    \vspace{6pt}

    \fontsize{14}{16.8}\selectfont\@subtitle
    \vspace{36pt}

    \vspace{12pt}
    \fontsize{12}{14.4}\selectfont \textbf{\@author}
    \vspace{144pt}

    \fontsize{9}{10.8}\selectfont\@reportnumber

    \@ordernumber

    \vfill
    }%
  \clearpage
  }

\RequirePackage{etoolbox}
\preto{\chapter}{\def\leveltitle{\chaptertitle}}
\pretocmd{\@chapter}
  {\expandafter\gdef\leveltitle{#2}}
  {}{}
\pretocmd{\@schapter}
  {\expandafter\gdef\leveltitle{#1}}
  {}{}

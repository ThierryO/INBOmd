# Inserting and executing R code with RMarkdown

You can find an R code chunk below this paragraph. Adding a new code chunk is easy in RStudio by pressing `Ctrl+Alt+I`.

```{r linear_model}
model <- lm(log(pressure) ~ poly(temperature, 2), data = pressure)
summary(model)
```

## Adding figures {#S:figures}

Adding R figures is easy (figure \@ref(fig:pressure)). The `echo = FALSE` argument was added to the chunk options. This hides the R code that generates the figure. The `fig.cap` option adds a caption to the figure. The default label is a `fig:` prefix followed by the name of the chunk.

```{r pressure, echo = FALSE, fig.cap = "The caption"}
ggplot(pressure, aes(x = temperature, y = pressure)) + 
  geom_smooth(method = "lm", formula = y ~ poly(x, 2)) +
  geom_point() +
  scale_x_continuous("Temperature (deg C)") +
  scale_y_log10("Pressure (mm of Hg)") +
  ggtitle("pressure data: Vapor Pressure of Mercury")
```

_External_ figures can also be inserted from within an R code chunk, using the `include_graphics()` function (figure \@ref(fig:externalfig)). The same chunk options apply as before, including `fig.cap`.

```{r externalfig, fig.cap = "Including an external figure with a caption is easy from an R chunk.", out.width = "70%", fig.align = "center"}
path_to_figure <- system.file("local_tex/tex/latex/inboimage_2015","labo.jpg", package = "INBOmd")
include_graphics(path_to_figure)
```

But external figures can also be inserted and referenced outside R chunks, using bookdown-styled markdown: use `![(\#fig:your_unique_figurename)Your caption.](path-to-figure)` to insert a figure with its caption -- see figure \@ref(fig:externalfig2).

![(\#fig:externalfig2)This figure was inserted outside of an R chunk.](`r system.file("local_tex/tex/latex/inboimage_2015","labo.jpg", package = "INBOmd")`){ width=70% }


## Adding tables {#S:tables}

`kable()` is a handy function to display dataframes as a table (table \@ref(tab:kabletable)). The table will get a default label which is the prefix `tab:` plus the chunk name. Hence you can display only one table per chunk. Note that we need the argument `results='asis'`.

```{r kabletable, results='asis'}
kable(
  pressure,
  booktabs = TRUE,
  caption = "The caption of a Markdown table"
)
```

\FloatBarrier

When you want tables to break across multiple pages, add `longtable = TRUE` to the `kable()` function (table \@ref(tab:longtable)).
Note that the `booktabs` and `longtable` arguments only affect PDF output formats.

```{r longtable, results='asis'}
kable(
  pressure,
  booktabs = TRUE,
  longtable = TRUE,
  caption = "The caption of a Markdown table"
)
```

If you want to write (simple) tables directly as markdown and not from an R code chunk, there are several possible table notations. See http://pandoc.org/MANUAL.html#tables for more information. In this case, add the caption as a _separate paragraph_ above or below the table, using the following syntax:

    Table: (\#tab:your_unique_tablename)Your table-caption comes here.

An example is provided by table \@ref(tab:damselflies).

Scientific name | Dutch name | English name | French name
----------------|------------|--------------|-------------
Chalcolestes viridis | houtpantserjuffer | Western Willow Spreadwing | Leste vert
Lestes barbarus | zwervende pantserjuffer | Migrant Spreadwing | Leste sauvage
Lestes dryas | tangpantserjuffer | Robust Spreadwing | Leste dryade
Lestes sponsa | gewone pantserjuffer | Common Spreadwing | Leste fiancÃ© 
Lestes virens | tengere pantserjuffer | Small Spreadwing | Leste verdoyant
Sympecma fusca | bruine winterjuffer | Common Winter Damsel | Leste brun

Table: (\#tab:damselflies)Scientific and vernacular names of some members of the *Lestidae* family.
